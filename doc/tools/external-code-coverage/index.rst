External Code Coverage
======================

Scrutinizer can process code coverage information generated by an external service. This for example makes sense if
the set-up of your test-suite is complex or depends on interaction with other services like MySQL/RabbitMQ, etc.

Configuration
-------------
Configuration is a two step process. First, you need to tell Scrutinizer that you send code coverage information from
an external service in your build config. Second, you also need to configure your external service to send the code
coverage information to Scrutinizer.

Changes in Scrutinizer Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block :: yaml

    # .scrutinizer.yml
    tools:
        external_code_coverage: true

By default, Scrutinizer will wait 5 minutes for the code coverage information to arrive. If your test-suite runs longer
than that, you can change the timeout:

.. code-block :: yaml

    # .scrutinizer.yml
    tools:
        external_code_coverage:
            timeout: 600 # Timeout in seconds.

Changes in Third-Party Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In addition to modifying your Scrutinizer configuration, you also need to change the build configuration of your
external service to generate code coverage and then upload that code coverage information to Scrutinizer.

.. tip ::
    Make sure to always run the upload command even if your tests failed. In the latter case, the inspection
    will automatically be canceled on Scrutinizer.

PHP
^^^

.. code-block :: bash

    phpunit --coverage-clover=coverage.clover
    wget https://scrutinizer-ci.com/ocular.phar
    php ocular.phar code-coverage:upload --access-token="your-token" --format=php-clover coverage.clover

.. note ::
    If you have a public repository, you can omit the ``--access-token`` option. For private repositories, you can generate
    an access token on your profile page (https://scrutinizer-ci.com/profile/applications) - make sure to create it with
    ``READ`` access only.
